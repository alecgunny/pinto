
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Pinto &#8212; Pinto 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example Projects" href="examples.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="pinto">
<h1>Pinto<a class="headerlink" href="#pinto" title="Permalink to this headline">¶</a></h1>
<section class="tex2jax_ignore mathjax_ignore" id="pinto">
<h2>Pinto<a class="headerlink" href="#pinto" title="Permalink to this headline">¶</a></h2>
<p>A command line utility for managing and running jobs in complex Python environments.</p>
<p>Support tested for:</p>
<p><img alt="poetry 1.2.0a2" src="https://img.shields.io/badge/poetry-1.2.0a2-sucess" />
<img alt="poetry 1.2.0b2" src="https://img.shields.io/badge/poetry-1.2.0b2-sucess" />
<img alt="poetry 1.2.0b3" src="https://img.shields.io/badge/poetry-1.2.0b3-sucess" />
<img alt="poetry 1.2.1" src="https://img.shields.io/badge/poetry-1.2.1-sucess" />
<img alt="poetry 1.2.2" src="https://img.shields.io/badge/poetry-1.2.2-sucess" /></p>
<p><img alt="conda 4.10.3" src="https://img.shields.io/badge/conda-4.10.3-sucess" />
<img alt="conda 4.11.0" src="https://img.shields.io/badge/conda-4.11.0-sucess" />
<img alt="conda 4.12.0" src="https://img.shields.io/badge/conda-4.12.0-sucess" /></p>
<section id="background">
<h3>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h3>
<p>Most ongoing research in the <a class="reference external" href="https://github.com/ML4GW">ML4GW</a> organization leverages <a class="reference external" href="https://python-poetry.org/">Poetry</a> for managing Python virtual environments in the context of a <a class="reference external" href="https://medium.com/opendoor-labs/our-python-monorepo-d34028f2b6fa">Python monorepo</a>. In particular, Poetry makes managing a shared set of libraries between jobs within a project <a class="reference external" href="https://python-poetry.org/docs/dependency-specification/#path-dependencies">simple and straightforward</a>.</p>
<p>However, several tools in the Python gravitational wave analysis ecosystem cannot be installed via Pip (in particular the <a class="reference external" href="https://anaconda.org/conda-forge/python-ldas-tools-framecpp/">library</a> GWpy uses to read and write <code class="docutils literal notranslate"><span class="pre">.gwf</span></code> files and the library it uses for <a class="reference external" href="https://anaconda.org/conda-forge/python-nds2-client">reading archival data from the NDS2 server</a>). This complicates the environment management picture by having some projects which use Poetry to install local libraries as well as their own code into <em>Conda</em> virtual environments, and others which don’t require Conda at all and can install all the libraries they need into <em>Poetry</em> virtual environments.</p>
<section id="enter-pinto">
<h4>Enter: <code class="docutils literal notranslate"><span class="pre">pinto</span></code><a class="headerlink" href="#enter-pinto" title="Permalink to this headline">¶</a></h4>
<p>Pinto  attempts to simplify this picture by installing a single tool in the base Conda environment which can dynamically detect whether a project requires Conda, create the appropriate virtual environment, and install all necessary libraries into it.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pinto -p /path/to/my/project build</span>
</pre></div>
</div>
<p>It can then be used to run jobs inside of that virtual environment.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pinto -p /path/to/my/project run my-command --arg1</span>
</pre></div>
</div>
<p>If you’re currently in the project’s directory, you can drop the <code class="docutils literal notranslate"><span class="pre">-p/--project</span></code> flag altogether for any pinto command, e.g.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pinto build</span>
<span class="go">pinto run my-command --arg1</span>
</pre></div>
</div>
</section>
</section>
<section id="structuring-a-project-with-pinto">
<h3>Structuring a project with Pinto<a class="headerlink" href="#structuring-a-project-with-pinto" title="Permalink to this headline">¶</a></h3>
<p>To leverage Pinto in a project, all you need is the <a class="reference external" href="https://python-poetry.org/docs/pyproject/"><code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file</a> required by Poetry which specifies your project’s dependencies. If just this file is present, <code class="docutils literal notranslate"><span class="pre">pinto</span></code> will treat your project as a “vanilla” Poetry project and manage all of its dependencies inside a Poetry virtual environment.</p>
<section id="but-what-if-i-need-conda">
<h4>But what if I need Conda?<a class="headerlink" href="#but-what-if-i-need-conda" title="Permalink to this headline">¶</a></h4>
<p>Inidicating to Pinto that your project requires Conda is as simple as including a <code class="docutils literal notranslate"><span class="pre">poetry.toml</span></code> file in your project directory with the lines</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[virtualenvs]</span>
<span class="n">create</span> <span class="o">=</span> <span class="kc">false</span>
</pre></div>
</div>
<p>Alternatively, from you project directory you can run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">poetry config virtualenvs.create false --local</span>
</pre></div>
</div>
<p>When building your project, <code class="docutils literal notranslate"><span class="pre">pinto</span></code> will first look for an entry that looks like</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.pinto]</span>
<span class="n">base_env</span> <span class="o">=</span> <span class="s">&quot;/path/to/environment.yaml&quot;</span>
</pre></div>
</div>
<p>In your project’s <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>. If this entry doesn’t exist, <code class="docutils literal notranslate"><span class="pre">pinto</span></code> will look for a file called either <code class="docutils literal notranslate"><span class="pre">environment.yaml</span></code> or <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> starting in your project’s directory, then ascending up your directory tree to the root, using the first file it finds. This way, you can easily have a base <code class="docutils literal notranslate"><span class="pre">environment.yaml</span></code> in the root of a monorepo from on top of which all your projects build, while leaving projects the option of overriding this base image with their own <code class="docutils literal notranslate"><span class="pre">environment.yaml</span></code>.</p>
<p>In fact, if the <code class="docutils literal notranslate"><span class="pre">name</span></code> listed in the <code class="docutils literal notranslate"><span class="pre">environment.yaml</span></code> discovered by <code class="docutils literal notranslate"><span class="pre">pinto</span></code> ends with <code class="docutils literal notranslate"><span class="pre">-base</span></code>, <code class="docutils literal notranslate"><span class="pre">pinto</span></code> will automatically name your project’s virtual environment <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;-&lt;project-name&gt;</span></code>. For example, if the name of your project (as given in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>) is <code class="docutils literal notranslate"><span class="pre">nn-trainer</span></code>, and the <code class="docutils literal notranslate"><span class="pre">environment.yaml</span></code> at the root of your monorepo looks like</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">myproject-base</span>
<span class="nt">dependencies</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>then <code class="docutils literal notranslate"><span class="pre">pinto</span></code> will name your project’s virtual environment <code class="docutils literal notranslate"><span class="pre">myproject-nn-trainer</span></code>.</p>
<p>To see more examples of project structures, consult the <a class="reference internal" href="examples.html"><span class="doc std std-doc"><code class="docutils literal notranslate"><span class="pre">examples</span></code></span></a> folder.</p>
</section>
</section>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>For any non-containerized installation methods, please consult the support matrix at the top of this document to see which versions of Anaconda and Poetry are supported by <code class="docutils literal notranslate"><span class="pre">pinto</span></code>.</p>
<section id="container">
<h4>Container<a class="headerlink" href="#container" title="Permalink to this headline">¶</a></h4>
<p>The simplest way to get started with pinto is to use the container published by this repository, which is made available through GitHub’s container registry. You can pull it by running</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">ghcr</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">ML4GW</span><span class="o">/</span><span class="n">pinto</span><span class="p">:</span><span class="n">main</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry#authenticating-to-the-container-registry">this document</a> for information about how to authenticate to the GitHub container reigstry.</p>
</section>
<section id="conda">
<h4>Conda<a class="headerlink" href="#conda" title="Permalink to this headline">¶</a></h4>
<p>Pinto can only be installed on top of Anaconda, so make sure you have a <em>local</em> install available to work with (instructions found <a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/index.html">here</a>. I particularly recommend using Miniconda for a bare install, since most your work will be in virtual environments anyway.</p>
<blockquote>
<div><p><strong>NOTE</strong>: <code class="docutils literal notranslate"><span class="pre">pinto</span></code> is currently only compatible with 4.x Conda versions!! To find the appropriate Miniconda installer, please look at the <a class="reference external" href="https://repo.anaconda.com/miniconda/">installer archives</a>.</p>
</div></blockquote>
<p>Your options are then to either install <code class="docutils literal notranslate"><span class="pre">pinto</span></code> in the <code class="docutils literal notranslate"><span class="pre">base</span></code> conda environment (recommended), or in a virtual environment. If you choose to go the latter route, the conda environments managed by pinto will be kept in a subdirectory of pinto’s environment.</p>
<section id="installing-in-the-base-conda-environment">
<h5>Installing in the base conda environment<a class="headerlink" href="#installing-in-the-base-conda-environment" title="Permalink to this headline">¶</a></h5>
<p>First install poetry via pip</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(base)</span> <span class="go">~$ python -m pip install &quot;poetry&gt;1.2.0,&lt;1.3.0&quot;</span>
</pre></div>
</div>
<p>then install pinto via pip</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(base)</span> <span class="go">~$ python -m pip install git+https://github.com/ML4GW/pinto@main</span>
</pre></div>
</div>
</section>
<section id="in-a-virtual-environment">
<h5>In a virtual environment<a class="headerlink" href="#in-a-virtual-environment" title="Permalink to this headline">¶</a></h5>
<p>If you don’t want to install pinto into your <code class="docutils literal notranslate"><span class="pre">base</span></code> conda environment, you can install it by creating an environment file like the one found <span class="xref myst">here</span>, and creating a virtual environment like:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(base)</span> <span class="go">~$ conda env create -f environment.yaml</span>
</pre></div>
</div>
<p>You can then activate your pinto environment and execute commands inside of it</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(base)</span> <span class="go">~$ conda activate pinto</span>
<span class="gp gp-VirtualEnv">(pinto)</span> <span class="go">~$ pinto --version</span>
</pre></div>
</div>
</section>
</section>
<section id="setting-the-poetry-virtualenvs-path">
<h4>Setting the Poetry virtualenvs path<a class="headerlink" href="#setting-the-poetry-virtualenvs-path" title="Permalink to this headline">¶</a></h4>
<p>Whether you installed pinto your base environment or in a virtual environment, we recommend setting up Poetry’s default virtual environment path so that it installs environments to the same location as conda. With the desired environment activated, run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(base OR pinto)</span> <span class="go">~$ poetry config virtualenvs.path $CONDA_PREFIX/envs</span>
</pre></div>
</div>
</section>
<section id="development-installation">
<h4>Development Installation<a class="headerlink" href="#development-installation" title="Permalink to this headline">¶</a></h4>
<p>To develop pinto, clone the repo locally</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(base)</span> <span class="go">~$ git clone https://github.com/ML4GW/pinto.git</span>
</pre></div>
</div>
<p>Then complete either installation method above, but with the local library installed editably. For base installs:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(base)</span> <span class="go">~$ python -m pip install -e ./pinto[dev]</span>
</pre></div>
</div>
<p>For virtual environment installs, edit the <code class="docutils literal notranslate"><span class="pre">environment.yaml</span></code> so that the pinto install line is replaced with</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span>  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-e .[dev]</span>
</pre></div>
</div>
<p>Then run</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(base)</span> <span class="go">~$ cd pinto</span>
<span class="gp gp-VirtualEnv">(base)</span> <span class="go">~$ conda env create -f environment.yaml</span>
</pre></div>
</div>
</section>
</section>
</section>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Content:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Example Projects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simple-poetry-example_link.html">Simple Poetry Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="simple-conda-example_link.html">Simple Conda Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="nested-conda-example_link.html">Nested Conda Example</a></li>
</ul>
</li>
</ul>
</div>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">Pinto</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Content:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Example Projects</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="examples.html" title="next chapter">Example Projects</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Alec Gunny.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>